var mysql1 = require('./test');
var Web3 = require('web3');
var checkUtils = require('./checkUtils');

const web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:1111'));
var adminAccount = "0xa2b493693bc3c888d963234fcee0f83071cd3a0a";
var adminPassword = "123123";
var contractAddress = "0x1cf95d9eceaa6c154f3c390b7037e31e6f13e288";
var jsonInterface = [
	{
		"constant": false,
		"inputs": [
			{
				"name": "t_id",
				"type": "uint256"
			},
			{
				"name": "typeValues",
				"type": "string"
			}
		],
		"name": "updateType",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "t_id",
				"type": "uint256"
			}
		],
		"name": "getType_ids",
		"outputs": [
			{
				"name": "",
				"type": "string[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "t_id",
				"type": "uint256"
			},
			{
				"name": "typeValues",
				"type": "string"
			}
		],
		"name": "checkTypeValuse",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "t_id",
				"type": "uint256"
			}
		],
		"name": "delType",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "id",
				"type": "string"
			}
		],
		"name": "getNote",
		"outputs": [
			{
				"components": [
					{
						"name": "id",
						"type": "string"
					},
					{
						"name": "date",
						"type": "string"
					},
					{
						"name": "title",
						"type": "string"
					},
					{
						"name": "desc",
						"type": "string"
					},
					{
						"name": "content",
						"type": "string"
					},
					{
						"name": "t_id",
						"type": "uint256"
					},
					{
						"name": "username",
						"type": "string"
					}
				],
				"name": "",
				"type": "tuple"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "t_id",
				"type": "uint256"
			}
		],
		"name": "getType",
		"outputs": [
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "username",
				"type": "string"
			}
		],
		"name": "getUser_id",
		"outputs": [
			{
				"name": "",
				"type": "string[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "username",
				"type": "string"
			},
			{
				"name": "date",
				"type": "string"
			},
			{
				"name": "id",
				"type": "string"
			},
			{
				"name": "title",
				"type": "string"
			},
			{
				"name": "desc",
				"type": "string"
			},
			{
				"name": "content",
				"type": "string"
			},
			{
				"name": "t_id",
				"type": "uint256"
			}
		],
		"name": "addNote",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "id",
				"type": "string"
			},
			{
				"name": "username",
				"type": "string"
			}
		],
		"name": "delNote",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "typeValues",
				"type": "string"
			}
		],
		"name": "addType",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "username",
				"type": "string"
			},
			{
				"name": "date",
				"type": "string"
			},
			{
				"name": "id",
				"type": "string"
			},
			{
				"name": "title",
				"type": "string"
			},
			{
				"name": "desc",
				"type": "string"
			},
			{
				"name": "content",
				"type": "string"
			},
			{
				"name": "t_id",
				"type": "uint256"
			}
		],
		"name": "updateNote",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	}
];
// [{"constant":false,"inputs":[{"name":"date","type":"string"},{"name":"id","type":"string"},{"name":"title","type":"string"},{"name":"desc","type":"string"},{"name":"content","type":"string"}],"name":"addNote","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"date","type":"string"},{"name":"count","type":"uint256"}],"name":"getNoteList","outputs":[{"components":[{"name":"tile","type":"string"},{"name":"desc","type":"string"},{"name":"content","type":"string"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"date","type":"string"},{"name":"id","type":"string"}],"name":"getNote","outputs":[{"components":[{"name":"tile","type":"string"},{"name":"desc","type":"string"},{"name":"content","type":"string"}],"name":"","type":"tuple"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}];
var bytecode = '0x6080604052600060065534801561001557600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550612ab9806100656000396000f3fe6080604052600436106100a9576000357c01000000000000000000000000000000000000000000000000000000009004806308b0b078146100ae57806313e7f78e146100d757806319b9fb10146101145780632644859d146101515780633d88c5151461017a5780634036ab78146101b75780634c2dd352146101f5578063674a8939146102325780636a2e3d251461025b578063e7f08e6914610284578063fb192612146102ad575b600080fd5b3480156100ba57600080fd5b506100d560048036036100d091908101906126de565b6102ea565b005b3480156100e357600080fd5b506100fe60048036036100f991908101906126b5565b610386565b60405161010b91906128e9565b60405180910390f35b34801561012057600080fd5b5061013b600480360361013691908101906126de565b610482565b604051610148919061290b565b60405180910390f35b34801561015d57600080fd5b50610178600480360361017391908101906126b5565b610653565b005b34801561018657600080fd5b506101a1600480360361019c91908101906124da565b610922565b6040516101ae9190612956565b60405180910390f35b3480156101c357600080fd5b506101de60048036036101d991908101906126b5565b610ed0565b6040516101ec929190612926565b60405180910390f35b34801561020157600080fd5b5061021c600480360361021791908101906124da565b610f8f565b60405161022991906128e9565b60405180910390f35b34801561023e57600080fd5b5061025960048036036102549190810190612587565b6110e3565b005b34801561026757600080fd5b50610282600480360361027d919081019061251b565b611451565b005b34801561029057600080fd5b506102ab60048036036102a691908101906124da565b611a1b565b005b3480156102b957600080fd5b506102d460048036036102cf9190810190612587565b611aaf565b6040516102e1919061290b565b60405180910390f35b3373ffffffffffffffffffffffffffffffffffffffff166000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614151561034557600080fd5b61034f8282610482565b1561035957610382565b80600260008481526020019081526020016000209080519060200190610380929190612085565b505b5050565b606060056000838152602001908152602001600020805480602002602001604051908101604052809291908181526020016000905b82821015610477578382906000526020600020018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156104635780601f1061043857610100808354040283529160200191610463565b820191906000526020600020905b81548152906001019060200180831161044657829003601f168201915b5050505050815260200190600101906103bb565b505050509050919050565b600080600090506000600190505b600654811115156106485760008514151561057757808514151561057257610563600260008381526020019081526020016000208054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105585780601f1061052d57610100808354040283529160200191610558565b820191906000526020600020905b81548152906001019060200180831161053b57829003601f168201915b505050505085611dcb565b156105715760019150610648565b5b61063b565b61062c600260008381526020019081526020016000208054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106215780601f106105f657610100808354040283529160200191610621565b820191906000526020600020905b81548152906001019060200180831161060457829003601f168201915b505050505085611dcb565b1561063a5760019150610648565b5b8080600101915050610490565b508091505092915050565b3373ffffffffffffffffffffffffffffffffffffffff166000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415156106ae57600080fd5b6002600082815260200190815260200160002060006106cd9190612105565b60008090505b60056000838152602001908152602001600020805490508110156108ff576060600560008481526020019081526020016000208281548110151561071357fe5b906000526020600020018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107b15780601f10610786576101008083540402835291602001916107b1565b820191906000526020600020905b81548152906001019060200180831161079457829003601f168201915b5050505050905060006003826040518082805190602001908083835b6020831015156107f257805182526020820191506020810190506020830392506107cd565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020549050606060018281548110151561083957fe5b90600052602060002090600702016006018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156108de5780601f106108b3576101008083540402835291602001916108de565b820191906000526020600020905b8154815290600101906020018083116108c157829003601f168201915b505050505090506108ef8382611451565b50505080806001019150506106d3565b5060056000828152602001908152602001600020600061091f919061214d565b50565b61092a61216e565b610a5760016003846040518082805190602001908083835b6020831015156109675780518252602082019150602081019050602083039250610942565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020548154811015156109a757fe5b90600052602060002090600702016000018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a4c5780601f10610a2157610100808354040283529160200191610a4c565b820191906000526020600020905b815481529060010190602001808311610a2f57829003601f168201915b505050505083611dcb565b1515610a5f57fe5b60016003836040518082805190602001908083835b602083101515610a995780518252602082019150602081019050602083039250610a74565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902054815481101515610ad957fe5b906000526020600020906007020160e06040519081016040529081600082018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b8c5780601f10610b6157610100808354040283529160200191610b8c565b820191906000526020600020905b815481529060010190602001808311610b6f57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c2e5780601f10610c0357610100808354040283529160200191610c2e565b820191906000526020600020905b815481529060010190602001808311610c1157829003601f168201915b50505050508152602001600282018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610cd05780601f10610ca557610100808354040283529160200191610cd0565b820191906000526020600020905b815481529060010190602001808311610cb357829003601f168201915b50505050508152602001600382018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610d725780601f10610d4757610100808354040283529160200191610d72565b820191906000526020600020905b815481529060010190602001808311610d5557829003601f168201915b50505050508152602001600482018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610e145780601f10610de957610100808354040283529160200191610e14565b820191906000526020600020905b815481529060010190602001808311610df757829003601f168201915b5050505050815260200160058201548152602001600682018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610ec05780601f10610e9557610100808354040283529160200191610ec0565b820191906000526020600020905b815481529060010190602001808311610ea357829003601f168201915b5050505050815250509050919050565b6060600060026000848152602001908152602001600020600654818054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610f7f5780601f10610f5457610100808354040283529160200191610f7f565b820191906000526020600020905b815481529060010190602001808311610f6257829003601f168201915b5050505050915091509150915091565b60606004826040518082805190602001908083835b602083101515610fc95780518252602082019150602081019050602083039250610fa4565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020805480602002602001604051908101604052809291908181526020016000905b828210156110d8578382906000526020600020018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156110c45780601f10611099576101008083540402835291602001916110c4565b820191906000526020600020905b8154815290600101906020018083116110a757829003601f168201915b50505050508152602001906001019061101c565b505050509050919050565b6111a8600260008381526020019081526020016000208054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561118d5780601f106111625761010080835404028352916020019161118d565b820191906000526020600020905b81548152906001019060200180831161117057829003601f168201915b50505050506020604051908101604052806000815250611dcb565b1515156111b157fe5b6111b961216e565b60e0604051908101604052808781526020018881526020018681526020018581526020018481526020018381526020018981525090506001819080600181540180825580915050906001820390600052602060002090600702016000909192909190915060008201518160000190805190602001906112399291906121ac565b5060208201518160010190805190602001906112569291906121ac565b5060408201518160020190805190602001906112739291906121ac565b5060608201518160030190805190602001906112909291906121ac565b5060808201518160040190805190602001906112ad9291906121ac565b5060a0820151816005015560c08201518160060190805190602001906112d49291906121ac565b5050505060018080549050036003876040518082805190602001908083835b60208310151561131857805182526020820191506020810190506020830392506112f3565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020819055506004886040518082805190602001908083835b6020831015156113875780518252602082019150602081019050602083039250611362565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390208690806001815401808255809150509060018203906000526020600020016000909192909190915090805190602001906113f5929190612085565b505060056000838152602001908152602001600020869080600181540180825580915050906001820390600052602060002001600090919290919091509080519060200190611445929190612085565b50505050505050505050565b600060016003846040518082805190602001908083835b60208310151561148d5780518252602082019150602081019050602083039250611468565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020548154811015156114cd57fe5b906000526020600020906007020160050154905060006003846040518082805190602001908083835b60208310151561151b57805182526020820191506020810190506020830392506114f6565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020549050600060016003866040518082805190602001908083835b60208310151561158d5780518252602082019150602081019050602083039250611568565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020540190505b600180549050811015611719578160036001838154811015156115e457fe5b906000526020600020906007020160000160405180828054600181600116156101000203166002900480156116505780601f1061162e576101008083540402835291820191611650565b820191906000526020600020905b81548152906001019060200180831161163c575b5050915050908152602001604051809103902054111561170c57600360018281548110151561167b57fe5b906000526020600020906007020160000160405180828054600181600116156101000203166002900480156116e75780601f106116c55761010080835404028352918201916116e7565b820191906000526020600020905b8154815290600101906020018083116116d3575b5050915050908152602001604051809103902060008154809291906001900391905055505b80806001019150506115c5565b5060006003856040518082805190602001908083835b602083101515611754578051825260208201915060208101905060208303925061172f565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390205490505b60018080549050038110156118e05760018082018154811015156117ab57fe5b90600052602060002090600702016001828154811015156117c857fe5b9060005260206000209060070201600082018160000190805460018160011615610100020316600290046117fd92919061222c565b506001820181600101908054600181600116156101000203166002900461182592919061222c565b506002820181600201908054600181600116156101000203166002900461184d92919061222c565b506003820181600301908054600181600116156101000203166002900461187592919061222c565b506004820181600401908054600181600116156101000203166002900461189d92919061222c565b5060058201548160050155600682018160060190805460018160011615610100020316600290046118cf92919061222c565b50905050808060010191505061178b565b506001808080549050038154811015156118f657fe5b9060005260206000209060070201600080820160006119159190612105565b6001820160006119259190612105565b6002820160006119359190612105565b6003820160006119459190612105565b6004820160006119559190612105565b600582016000905560068201600061196d9190612105565b5050600180548091906001900361198491906122b3565b506119f9846004856040518082805190602001908083835b6020831015156119c1578051825260208201915060208101905060208303925061199c565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020611ecf565b611a158460056000858152602001908152602001600020611ecf565b50505050565b3373ffffffffffffffffffffffffffffffffffffffff166000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141515611a7657600080fd5b600160065401600681905550806002600060065481526020019081526020016000209080519060200190611aab929190612085565b5050565b6000611ab961216e565b60e0604051908101604052808881526020018981526020018781526020018681526020018581526020018481526020018a81525090508060016003896040518082805190602001908083835b602083101515611b2a5780518252602082019150602081019050602083039250611b05565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902054815481101515611b6a57fe5b90600052602060002090600702016000820151816000019080519060200190611b949291906121ac565b506020820151816001019080519060200190611bb19291906121ac565b506040820151816002019080519060200190611bce9291906121ac565b506060820151816003019080519060200190611beb9291906121ac565b506080820151816004019080519060200190611c089291906121ac565b5060a0820151816005015560c0820151816006019080519060200190611c2f9291906121ac565b50905050611ca78760048b6040518082805190602001908083835b602083101515611c6f5780518252602082019150602081019050602083039250611c4a565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020611ecf565b6004896040518082805190602001908083835b602083101515611cdf5780518252602082019150602081019050602083039250611cba565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020879080600181540180825580915050906001820390600052602060002001600090919290919091509080519060200190611d4d929190612085565b5050611d6b8760056000868152602001908152602001600020611ecf565b60056000848152602001908152602001600020879080600181540180825580915050906001820390600052602060002001600090919290919091509080519060200190611db9929190612085565b50506001915050979650505050505050565b60008060009050826040516020018082805190602001908083835b602083101515611e0b5780518252602082019150602081019050602083039250611de6565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405160208183030381529060405280519060200120846040516020018082805190602001908083835b602083101515611e7f5780518252602082019150602081019050602083039250611e5a565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051602081830303815290604052805190602001201415611ec557600190505b8091505092915050565b6000808280549050905060008090505b8380549050811015611fbf57611fa5858583815481101515611efd57fe5b906000526020600020018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611f9b5780601f10611f7057610100808354040283529160200191611f9b565b820191906000526020600020905b815481529060010190602001808311611f7e57829003601f168201915b5050505050611dcb565b15611fb257809250611fbf565b8080600101915050611edf565b508082101515611fd0575050612081565b60008290505b60018203811015612041578360018201815481101515611ff257fe5b90600052602060002001848281548110151561200a57fe5b9060005260206000200190805460018160011615610100020316600290046120339291906122e5565b508080600101915050611fd6565b50826001820381548110151561205357fe5b9060005260206000200160006120699190612105565b8280548091906001900361207d919061236c565b5050505b5050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106120c657805160ff19168380011785556120f4565b828001600101855582156120f4579182015b828111156120f35782518255916020019190600101906120d8565b5b5090506121019190612398565b5090565b50805460018160011615610100020316600290046000825580601f1061212b575061214a565b601f0160209004906000526020600020908101906121499190612398565b5b50565b508054600082559060005260206000209081019061216b91906123bd565b50565b60e060405190810160405280606081526020016060815260200160608152602001606081526020016060815260200160008152602001606081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106121ed57805160ff191683800117855561221b565b8280016001018555821561221b579182015b8281111561221a5782518255916020019190600101906121ff565b5b5090506122289190612398565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061226557805485556122a2565b828001600101855582156122a257600052602060002091601f016020900482015b828111156122a1578254825591600101919060010190612286565b5b5090506122af9190612398565b5090565b8154818355818111156122e0576007028160070283600052602060002091820191016122df91906123e9565b5b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061231e578054855561235b565b8280016001018555821561235b57600052602060002091601f016020900482015b8281111561235a57825482559160010191906001019061233f565b5b5090506123689190612398565b5090565b8154818355818111156123935781836000526020600020918201910161239291906123bd565b5b505050565b6123ba91905b808211156123b657600081600090555060010161239e565b5090565b90565b6123e691905b808211156123e257600081816123d99190612105565b506001016123c3565b5090565b90565b61246d91905b8082111561246957600080820160006124089190612105565b6001820160006124189190612105565b6002820160006124289190612105565b6003820160006124389190612105565b6004820160006124489190612105565b60058201600090556006820160006124609190612105565b506007016123ef565b5090565b90565b600082601f830112151561248357600080fd5b8135612496612491826129a5565b612978565b915080825260208301602083018583830111156124b257600080fd5b6124bd838284612a2c565b50505092915050565b60006124d28235612a22565b905092915050565b6000602082840312156124ec57600080fd5b600082013567ffffffffffffffff81111561250657600080fd5b61251284828501612470565b91505092915050565b6000806040838503121561252e57600080fd5b600083013567ffffffffffffffff81111561254857600080fd5b61255485828601612470565b925050602083013567ffffffffffffffff81111561257157600080fd5b61257d85828601612470565b9150509250929050565b600080600080600080600060e0888a0312156125a257600080fd5b600088013567ffffffffffffffff8111156125bc57600080fd5b6125c88a828b01612470565b975050602088013567ffffffffffffffff8111156125e557600080fd5b6125f18a828b01612470565b965050604088013567ffffffffffffffff81111561260e57600080fd5b61261a8a828b01612470565b955050606088013567ffffffffffffffff81111561263757600080fd5b6126438a828b01612470565b945050608088013567ffffffffffffffff81111561266057600080fd5b61266c8a828b01612470565b93505060a088013567ffffffffffffffff81111561268957600080fd5b6126958a828b01612470565b92505060c06126a68a828b016124c6565b91505092959891949750929550565b6000602082840312156126c757600080fd5b60006126d5848285016124c6565b91505092915050565b600080604083850312156126f157600080fd5b60006126ff858286016124c6565b925050602083013567ffffffffffffffff81111561271c57600080fd5b61272885828601612470565b9150509250929050565b600061273d826129de565b80845260208401935083602082028501612756856129d1565b60005b8481101561278f5783830388526127718383516127e5565b925061277c826129ff565b9150602088019750600181019050612759565b508196508694505050505092915050565b6127a981612a0c565b82525050565b60006127ba826129f4565b8084526127ce816020860160208601612a3b565b6127d781612a6e565b602085010191505092915050565b60006127f0826129e9565b808452612804816020860160208601612a3b565b61280d81612a6e565b602085010191505092915050565b600060e083016000830151848203600086015261283882826127e5565b9150506020830151848203602086015261285282826127e5565b9150506040830151848203604086015261286c82826127e5565b9150506060830151848203606086015261288682826127e5565b915050608083015184820360808601526128a082826127e5565b91505060a08301516128b560a08601826128da565b5060c083015184820360c08601526128cd82826127e5565b9150508091505092915050565b6128e381612a18565b82525050565b600060208201905081810360008301526129038184612732565b905092915050565b600060208201905061292060008301846127a0565b92915050565b6000604082019050818103600083015261294081856127af565b905061294f60208301846128da565b9392505050565b60006020820190508181036000830152612970818461281b565b905092915050565b6000604051905081810181811067ffffffffffffffff8211171561299b57600080fd5b8060405250919050565b600067ffffffffffffffff8211156129bc57600080fd5b601f19601f8301169050602081019050919050565b6000602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b60008115159050919050565b6000819050919050565b6000819050919050565b82818337600083830152505050565b60005b83811015612a59578082015181840152602081019050612a3e565b83811115612a68576000848401525b50505050565b6000601f19601f830116905091905056fea265627a7a723058208b7cb6aad1e295ba4ce7db907041daf10456d3bb7881c967a74eae7c05d1bd1e6c6578706572696d656e74616cf50037';
var bn = new web3.eth.Contract(jsonInterface);
//测试
function test(body) {
	var username = body.userName;
	console.log(username);
	return 'result';
}
//创建账户
async function newAccount(password) {
	var account = "account";
	console.log(password);
	await web3.eth.personal.newAccount(password, function (error, data) {
		console.log("创建的新账户地址：" + data)
		account = data;
	});
	sendToAccount(account, '10');
	return account;
}

//转账给用户
async function sendToAccount(account, amount) {
	var result = await unlockAccount(adminAccount,adminPassword);
	if(!result){return {'result':'账户解锁失败'}}
	web3.eth.sendTransaction({
		from: adminAccount,
		to: account,
		value: web3.utils.toWei(amount)
	}, function (error, data) {
		console.log("交易的hash值：" + data);
	});
}

//解锁账户
async function unlockAccount(account, password) {
	var result = false;
	await web3.eth.personal.unlockAccount(account, password, 300, function (error, data) {
		console.log(account + "解锁结果：" + data);
		result = data;
	});
	return result;
}
//部署合约方法的转发，因为没有返回值，server.js中会报错
async function deploy(account,password) {
	// var account = body.account;
	// var password = body.password;
	var result = await unlockAccount(account,password);
	
	if (result) {//解锁当前用户的以太坊账户
		var address = await deployContract(account);
	}

	return {'contractAddress':address};
}
//部署合约  
function deployContract(account) {
	//部署合约
	return new Promise(function(resolve, reject) {
		bn.deploy({
			data: bytecode
		}).send({
				from: account,
				gas: 3000000,
				gasPrice: '300000000000'
			}, function (error, transactionHash) {
				console.log(error);
			})
			.on('receipt', function (receipt) {
				console.log('合约部署地址：' + receipt.contractAddress) // 收据中包含了新的合约地址
				resolve(receipt.contractAddress);
			});
	});
}
//创建用户对象
function user(userName,name,password,addr,account)
{
    this.userName = userName;
    this.name = name;
    this.password = password;
    this.addr = addr;
	this.account = account;
}
//创建文章对象
function essay(userName,title,desc,content,t_id)
{
    this.userName = userName;
    this.title = title;
    this.desc = desc;
    this.content = content;
	this.t_id = t_id;
}
//创建笔记对象
function titles(id,date,title,desc,content)
{
    this.id = id;
    this.date = date;
    this.title = title;
    this.desc = desc;
	this.content = content;
}
function getBalance(account){
    return new Promise(function(resolve, reject) {
        web3.eth.getBalance(account,function (error, data) {
//             console.log(error);
            resolve(data);
        });
    });
}
//添加笔记
async function addNote(body,account,password){
	/*获取参数 begin*/
	var t_id = body.t_id;
	var userName = body.userName;
	var title = body.title;
	var desc = body.desc;
	var content = body.content;
	// var account = body.account;
	// var password = body.password;
	/*获取参数end*/
	//解锁
	var result = await unlockAccount(account,password);
	if(!result){return {'result':'账户解锁失败'}}
	var date = checkUtils.getNowFormatDate();
	console.log("nodeDate:|"+date+"|");
	var id = web3.utils.sha3(new Date().getTime()+title+desc+content)+"";
	console.log("noteId:id:"+id);
	//add合约请求
	bn.options.address = contractAddress;
	var flag =  await bn.methods.addNote(userName,date,id,title,desc,content,t_id).send({
		from:account,
		gas: 3000000,
		gasPrice: '300000000000'
	},function(error,data){
		console.log("addNote method result:"+error);
		console.log("addNoteData method data:"+data);
		if (!error) {
			console.log('数据已提交')
			result = true;
		}
		else{
			console.log('数据提交失败')
			result = false;
		}
	});
	if(flag){
		
		return {"outcomeCode":1,"result":true};
	 }else{
		return {"outcomeCode":0,"result":false};
	 }
	sendToAccount(account,'10');
	return result;
}
//公开笔记的添加
async function addN(body){
	var userName = body.userName;
	var result = await mysql1.selectUser1(userName);
	if(typeof result[0] == "undefined"){
		return {'outcomeCode':-1,"result":false};
	}
	var user1 = new user(result[0].userName,result[0].name,result[0].password,result[0].addr,result[0].account);
	var account = user1.account;
	var password = user1.password;
	var result;
	if((!checkUtils.isEmpty(body.title))&&(!checkUtils.isEmpty(body.desc))&&(!checkUtils.isEmpty(body.content))){
		result = await addNote(body,account,password);
		console.log(result);
	}else{
		return "有数据为空";
	}
	return result;
}
//添加类型
async function addType(value,account,password){
	/*获取参数 begin*/
	// var value = body.value;
	// var account = body.account;
	// var password = body.password;
	// var contractAddress = body.contractAddress;
	/*获取参数end*/
	//解锁
	var result = await unlockAccount(account,password);
	if(!result){return {'result':'账户解锁失败'}}
	//add合约请求
	bn.options.address = contractAddress;
	await bn.methods.addType(value).send({
		from:account,
		gas: 3000000,
		gasPrice: '300000000000'
	},function(error,data){
		console.log("addType method result:"+error);
		console.log("addType method data:"+data);
		if (!error) {
			console.log('数据已提交')
			result = true;
		}
		else{
			console.log('数据提交失败')
			result = false;
		}
	});
	return result;
}
//增加话题
async function paddtype(value,account,password){
	// var value = body.value;
	// var account = body.account;
	// var password = body.password;
	var result = await unlockAccount(account,password);
	if(!result){return {'result':'账户解锁失败'}}
	bn.options.address = contractAddress;
	if((!checkUtils.isEmpty(value))){
		result = await new Promise(function(resolve, reject){
			 bn.methods.checkTypeValuse(0,value).call(
			{
				from:account
			}
			, function(error,data){
			//data:调用方法之后的返回值
				console.log("checkTypeValuse method result:"+error);
				console.log("checkTypeValuse method result:"+data);
				if (!error) {
					console.log('已查询是否重复')
					resolve(data);
				}
				else{
					console.log('未查询到')
					resolve(false);
				}
			});
		});
		console.log(result);
		if(!result){
			var result1 = await addType(value,account,password);
		}else{
			console.log('话题重复');
		}
	}
	console.log('增加话题结束');
	return result1;
}
//获取t_id总数
async function pgetnotype(account,password){
	// var account = body.account;
	// var password = body.password;
	var result = await unlockAccount(account,password);
	if(!result){return {'result':'账户解锁失败'}}
	bn.options.address = contractAddress;
	var data;
	data = await new Promise(function(resolve, reject){
			 bn.methods.getType(0).call(
			{
				from:account
			}
			, function(error,data){
			//data:调用方法之后的返回值
				console.log("checkTypeValuse method result:"+error);
				console.log("checkTypeValuse method result:"+data);
				if (!error) {
					resolve(data);
				}
				else{
					console.log(error)
					resolve(false);
				}
			});
		});
	return data[1];
}
//获取话题分页
async function pgettypevalues(account,password){
	// var account = body.account;
	// var password = body.password;
	var result = await unlockAccount(account,password);
	if(!result){return {'result':'账户解锁失败'}}
	bn.options.address = contractAddress;
	var types = new Array();
	var data2;
	var data1 = await pgetnotype(account,password);
	console.log('一共有'+data1+'个话题');
	for(var i=1;i<=data1;i++){
		data2 = await new Promise(function(resolve, reject){
			 bn.methods.getType(i).call(
			{
				from:account
			}
			, function(error,data){
			//data:调用方法之后的返回值
				console.log("checkTypeValuse method result:"+error);
				console.log("checkTypeValuse method result:"+data);
				if (!error) {
					resolve(data);
				}
				else{
					console.log(error)
					resolve(false);
				}
			});
		});
		types[i-1] = data2[0];
	}
	return types;//type[0]='话题名'
}
//获取指定t_id的笔记id[]
async function pgettype_ids(body,account,password){
	// var account = body.account;
	// var password = body.password;
	var result = await unlockAccount(account,password);
	if(!result){return {'result':'账户解锁失败'}}
	bn.options.address = contractAddress;
	var t_id = body.t_id;
	var data1 = await new Promise(function(resolve, reject){
			 bn.methods.getType_ids(t_id).call(
			{
				from:account
			}
			, function(error,data){
			//data:调用方法之后的返回值
				console.log("checkTypeValuse method result:"+error);
				console.log("checkTypeValuse method result:"+data);
				if (!error) {
					resolve(data);
				}
				else{
					console.log(error)
					resolve(false);
				}
			});
		});    
	return data1;
}
//分页(通过t_id获取该话题的笔记)
async function paging(body){
	var totalnum;//总记录数
	var totalpage;//总页数
	var page = body.page;
	var userName = body.userName;
	var noteList = [];
	var outcome;
	var t_id = body.t_id;
    if(checkUtils.isEmpty(page)||page==0){
        page = 1;
    }
	var result = await mysql1.selectUser1(body.userName);
	var outcomeCode = 1;
	if(typeof result[0] == "undefined"){
		return {"outcomeCode":-1,"result":false};
	}
	var user1 = new user(result[0].userName,result[0].name,result[0].password,result[0].addr,result[0].account);
	var account = user1.account;
	var noteids = await pgettype_ids(body,account,result[0].password);
	
	
    // console.log('body的'+userName);
    totalnum = noteids.length;
    if(totalnum/3 > parseInt(totalnum/3)){
         totalpage=parseInt(totalnum/3)+1;
     }else{
         totalpage=parseInt(totalnum/3);
     }
    console.log('总页数'+totalpage);
    if(page>totalpage){
        page = totalpage;
    }
	

    //计算分页后的下标
    var max,min;
    if(totalnum==0){
        max = 0;
        min = 1;
    }else{
        max = totalnum-(page-1)*3-1;
        min = totalnum-(page*3);
        if(min<0){
            min = 0;
        }
    }
    //计算分页后的下标结束
    var account = account;
	bn.options.address = contractAddress;
    for(var index=max;index>=min;index--){
     await bn.methods.getNote(noteids[index]).call({
     from:account
     }, function(error,data){
     //data:调用方法之后的返回值
     console.log("第"+index+"个笔记信息");
     console.log("getNoteByIndex method result:"+error);
     console.log("getNoteByIndex method result:"+data);
     noteList.push(data);
     if (error) {
     console.log("返回笔记信息失败");
     }else{
     console.log("data");
     }
     });
    }
    
    outcome = {"noteList":noteList,"page":page,"totalpage":totalpage,"totalnum":totalnum};
    return outcome;
    // console.log(titless);
}
//获得笔记列表
async function getNoteList1(body){
	var date = body.date;
	var count = body.count;
	var account = body.account;
	var password = body.password;
	console.log("获取参数date:"+date);
	var contractAddress = body.contractAddress;
	bn.options.address = contractAddress;
	var result = await unlockAccount(account,password);
	if(!result){return {'result':'账户解锁失败'}}
	await bn.methods.getNoteList(date,count)
					.call(
					{
						from:account
					}
					, function(error,data){
						//data:调用方法之后的返回值
						console.log("getNoteList method result:"+error);
						console.log("getNoteListData method result:"+data);
						if (error) {
							result = {'result':'获取笔记列表失败'};
						}else{
							result = {'result':data};
						}
					});
	return result;
}

//获得笔记列表
async function getNoteList(body){
	var id = body.id;
	var account = body.account;
	var password = body.password;
	var contractAddress = body.contractAddress;
	bn.options.address = contractAddress;
	var result = await unlockAccount(account,password);
	if(!result){return {'result':'账户解锁失败'}}
	await bn.methods.getNote(id)
					.call(
					{
						from:account
					}
					, function(error,data){
						//data:调用方法之后的返回值
						console.log("getNote method result:"+error);
						console.log("getNote method result:"+data);
						if (error) {
							result = {'result':'获取笔记列表失败'};
						}else{
							result = {'result':data};
						}
					});
	return result;
}

//获得一个笔记
async function getNote(body){
	/*获取参数begin*/
	var date = body.date;
	var id = body.id;
	var account = body.account;
	var password = body.password;
	/*获取参数end*/
	var result =await unlockAccount(account,password);
	if(result){//解锁当前用户的以太坊账户
		bn.options.address = contractAddress;
		await bn.methods.getNote(date,id).call({
				from:account
			},function(error,data){
				if (error) {
					result = {'result':'获取笔记列表失败'};
				}else{
					result = {'result':data};
				}
				console.log("getNote mothod result："+error);
				console.log("getNote mothod data："+data);
			});
	}
	return result;
}


//获取当前时间，格式YYYY-MM-DD
function getNowFormatDate() {
	var date = new Date();
	var seperator1 = "-";
	var year = date.getFullYear();
	var month = date.getMonth() + 1;
	var strDate = date.getDate();
	if (month >= 1 && month <= 9) {
		month = "0" + month;
	}
	if (strDate >= 0 && strDate <= 9) {
		strDate = "0" + strDate;
	}
	var currentdate = year + seperator1 + month + seperator1 + strDate;
	return currentdate;
}

function testCooie(body){
	console.log(body);
	return {"result":true,"userName":"wuzhuhaoCookie","name":"wuzhuhao"};
}

exports.test = test;
exports.testCooie = testCooie;
exports.newAccount = newAccount;
exports.deploy = deploy;
exports.addNote = addNote;
exports.addN = addN;
exports.getNote = getNote;
exports.getNoteList = getNoteList;
exports.addType = addType;
exports.paddtype = paddtype;
exports.pgettypevalues = pgettypevalues;
exports.pgetnotype = pgetnotype;
exports.pgettype_ids = pgettype_ids;
exports.paging = paging;